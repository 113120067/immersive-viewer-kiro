<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>iPhone ä¿®å¾©æ¸¬è©¦</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            padding: 15px;
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            min-height: 100vh;
        }
        
        .test-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border: 2px solid #28a745;
        }
        
        .test-input {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            border: 2px solid #28a745;
            border-radius: 10px;
            text-align: center;
            margin: 10px 0;
            -webkit-appearance: none;
        }
        
        .test-button {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            margin: 10px 0;
            border-radius: 10px;
            border: none;
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            font-weight: bold;
            -webkit-appearance: none;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            min-height: 56px;
        }
        
        .test-button:active {
            transform: scale(0.98);
            background: linear-gradient(135deg, #20c997, #17a2b8);
        }
        
        .status {
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            font-weight: bold;
            text-align: center;
        }
        
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .info { background: #d1ecf1; color: #0c5460; }
        
        .result-image {
            max-width: 100%;
            border: 3px solid #28a745;
            border-radius: 15px;
            margin: 15px 0;
            display: none;
        }
        
        .log {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 10px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="test-card">
            <h2 class="text-center text-success">ğŸ iPhone ä¿®å¾©æ¸¬è©¦</h2>
            <p class="text-center text-muted">æ¸¬è©¦æŒ‰éˆ•åŠŸèƒ½æ˜¯å¦åœ¨ iPhone ä¸Šæ­£å¸¸å·¥ä½œ</p>
        </div>
        
        <div class="test-card">
            <h5>ğŸ“ è¼¸å…¥æ¸¬è©¦</h5>
            <input type="text" id="testInput" class="test-input" placeholder="è¼¸å…¥è‹±æ–‡å–®å­—" value="apple">
            
            <form id="testForm">
                <button type="submit" id="testButton" class="test-button" ontouchstart="">
                    ğŸ¨ ç”Ÿæˆåœ–ç‰‡æ¸¬è©¦
                </button>
            </form>
            
            <button id="directButton" class="test-button" ontouchstart="">
                ğŸ”§ ç›´æ¥æŒ‰éˆ•æ¸¬è©¦
            </button>
        </div>
        
        <div id="status" class="status info">æº–å‚™æ¸¬è©¦...</div>
        
        <div class="test-card">
            <h5>ğŸ–¼ï¸ çµæœé¡¯ç¤º</h5>
            <div id="result"></div>
            <img id="resultImage" class="result-image">
        </div>
        
        <div class="test-card">
            <h5>ğŸ“‹ æ¸¬è©¦æ—¥èªŒ</h5>
            <div id="log" class="log"></div>
            <button id="clearLog" class="btn btn-sm btn-secondary">æ¸…é™¤æ—¥èªŒ</button>
        </div>
    </div>

    <script>
        // æ—¥èªŒç³»çµ±
        const logElement = document.getElementById('log');
        const statusElement = document.getElementById('status');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            console.log(logEntry);
            
            const div = document.createElement('div');
            div.textContent = logEntry;
            div.style.color = type === 'error' ? '#ff6b6b' : type === 'success' ? '#51cf66' : '#74c0fc';
            logElement.appendChild(div);
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function setStatus(message, type = 'info') {
            statusElement.textContent = message;
            statusElement.className = `status ${type}`;
        }
        
        // ç”Ÿæˆåœ–ç‰‡çš„æ ¸å¿ƒé‚è¼¯ï¼ˆèˆ‡ä¸»æ‡‰ç”¨ç›¸åŒï¼‰
        function generateImage(input) {
            log('ğŸ¨ é–‹å§‹ç”Ÿæˆåœ–ç‰‡: ' + input);
            setStatus('æ­£åœ¨ç”Ÿæˆåœ–ç‰‡...', 'warning');
            
            try {
                // ç”Ÿæˆ Pollinations URL
                const prompt = `cute cartoon ${input}`;
                const encodedPrompt = encodeURIComponent(prompt);
                const imageUrl = `https://image.pollinations.ai/prompt/${encodedPrompt}?width=1024&height=1024&model=flux&enhance=true`;
                
                log('ğŸ”— ç”Ÿæˆçš„ URL: ' + imageUrl);
                
                // è¼‰å…¥åœ–ç‰‡
                const img = document.getElementById('resultImage');
                const resultDiv = document.getElementById('result');
                
                let retryCount = 0;
                const maxRetries = 3;
                let loadTimeout;
                
                const loadImage = (url) => {
                    log(`ğŸ”„ è¼‰å…¥åœ–ç‰‡ (ç¬¬ ${retryCount + 1} æ¬¡)`);
                    
                    img.onload = function() {
                        log('âœ… åœ–ç‰‡è¼‰å…¥æˆåŠŸ', 'success');
                        setStatus('âœ… åœ–ç‰‡ç”ŸæˆæˆåŠŸï¼', 'success');
                        if (loadTimeout) clearTimeout(loadTimeout);
                        
                        resultDiv.innerHTML = `
                            <div class="alert alert-success">
                                <strong>ğŸ‰ æˆåŠŸï¼</strong><br>
                                å–®å­—: ${input}<br>
                                é‡è©¦æ¬¡æ•¸: ${retryCount}
                            </div>
                        `;
                        img.style.display = 'block';
                    };
                    
                    img.onerror = function() {
                        log('âŒ åœ–ç‰‡è¼‰å…¥å¤±æ•—', 'error');
                        if (loadTimeout) clearTimeout(loadTimeout);
                        
                        if (retryCount < maxRetries) {
                            retryCount++;
                            setTimeout(() => loadImage(url), 2000 * retryCount);
                        } else {
                            setStatus('âŒ åœ–ç‰‡è¼‰å…¥å¤±æ•—', 'error');
                            resultDiv.innerHTML = `
                                <div class="alert alert-danger">
                                    <strong>âŒ å¤±æ•—</strong><br>
                                    å·²é‡è©¦ ${maxRetries} æ¬¡
                                </div>
                            `;
                        }
                    };
                    
                    loadTimeout = setTimeout(() => {
                        log('â° è¼‰å…¥è¶…æ™‚');
                        if (retryCount < maxRetries) {
                            retryCount++;
                            loadImage(url);
                        }
                    }, 15000);
                    
                    img.src = url;
                };
                
                loadImage(imageUrl);
                
            } catch (error) {
                log('âŒ ç”Ÿæˆå¤±æ•—: ' + error.message, 'error');
                setStatus('âŒ ç”Ÿæˆå¤±æ•—', 'error');
            }
        }
        
        // äº‹ä»¶ç›£è½å™¨è¨­ç½®
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸ“± é é¢è¼‰å…¥å®Œæˆ', 'success');
            
            // è¨­å‚™ä¿¡æ¯
            log('ğŸ“± è¨­å‚™ä¿¡æ¯: ' + navigator.userAgent);
            log('ğŸ“± è§¸æ§æ”¯æ´: ' + ('ontouchstart' in window ? 'æ˜¯' : 'å¦'));
            log('ğŸ“± è¢å¹•å°ºå¯¸: ' + window.screen.width + 'x' + window.screen.height);
            
            // è¡¨å–®æäº¤æ¸¬è©¦
            const form = document.getElementById('testForm');
            const testButton = document.getElementById('testButton');
            const directButton = document.getElementById('directButton');
            const testInput = document.getElementById('testInput');
            
            // è¡¨å–®æäº¤äº‹ä»¶
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                log('ğŸ“ è¡¨å–®æäº¤äº‹ä»¶è§¸ç™¼', 'success');
                const input = testInput.value.trim();
                if (input) {
                    generateImage(input);
                } else {
                    log('âŒ è«‹è¼¸å…¥å–®å­—', 'error');
                    setStatus('âŒ è«‹è¼¸å…¥å–®å­—', 'error');
                }
            });
            
            // æ¸¬è©¦æŒ‰éˆ•è§¸æ§äº‹ä»¶
            testButton.addEventListener('touchstart', function(e) {
                e.preventDefault();
                log('ğŸ“± æ¸¬è©¦æŒ‰éˆ• touchstart äº‹ä»¶è§¸ç™¼', 'success');
                const input = testInput.value.trim();
                if (input) {
                    generateImage(input);
                }
            }, { passive: false });
            
            // æ¸¬è©¦æŒ‰éˆ•é»æ“Šäº‹ä»¶
            testButton.addEventListener('click', function(e) {
                e.preventDefault();
                log('ğŸ–±ï¸ æ¸¬è©¦æŒ‰éˆ• click äº‹ä»¶è§¸ç™¼', 'success');
            });
            
            // ç›´æ¥æŒ‰éˆ•æ¸¬è©¦
            directButton.addEventListener('touchstart', function(e) {
                e.preventDefault();
                log('ğŸ“± ç›´æ¥æŒ‰éˆ• touchstart äº‹ä»¶è§¸ç™¼', 'success');
                const input = testInput.value.trim();
                if (input) {
                    generateImage(input);
                }
            }, { passive: false });
            
            directButton.addEventListener('click', function(e) {
                e.preventDefault();
                log('ğŸ–±ï¸ ç›´æ¥æŒ‰éˆ• click äº‹ä»¶è§¸ç™¼', 'success');
            });
            
            // æ¸…é™¤æ—¥èªŒ
            document.getElementById('clearLog').addEventListener('click', function() {
                logElement.innerHTML = '';
                log('æ—¥èªŒå·²æ¸…é™¤');
            });
            
            setStatus('æº–å‚™å°±ç·’ï¼Œè«‹æ¸¬è©¦æŒ‰éˆ•åŠŸèƒ½', 'info');
        });
        
        // å…¨åŸŸéŒ¯èª¤è™•ç†
        window.addEventListener('error', function(e) {
            log('ğŸ’¥ JavaScript éŒ¯èª¤: ' + e.message, 'error');
        });
        
        window.addEventListener('unhandledrejection', function(e) {
            log('ğŸ’¥ Promise éŒ¯èª¤: ' + e.reason, 'error');
        });
    </script>
</body>
</html>
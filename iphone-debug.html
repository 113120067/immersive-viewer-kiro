<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>iPhone èª¿è©¦é é¢</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            padding: 10px;
            background: #f0f8ff;
        }
        .debug-info {
            background: #fff;
            border: 2px solid #007bff;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            font-size: 14px;
        }
        .test-button {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            margin: 10px 0;
            border-radius: 8px;
            border: none;
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            font-weight: bold;
        }
        .test-input {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            border: 2px solid #28a745;
            border-radius: 8px;
            text-align: center;
            margin: 10px 0;
        }
        .log {
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin: 10px 0;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div class="container-fluid">
        <h2>ğŸ“± iPhone èª¿è©¦é é¢</h2>
        
        <div class="debug-info">
            <h5>ğŸ” è¨­å‚™ä¿¡æ¯</h5>
            <div id="deviceInfo"></div>
        </div>
        
        <div class="debug-info">
            <h5>ğŸ§ª åŠŸèƒ½æ¸¬è©¦</h5>
            
            <input type="text" id="testInput" class="test-input" placeholder="è¼¸å…¥å–®å­—æ¸¬è©¦" value="apple">
            
            <button id="testBasic" class="test-button">1ï¸âƒ£ åŸºæœ¬åŠŸèƒ½æ¸¬è©¦</button>
            <button id="testForm" class="test-button">2ï¸âƒ£ è¡¨å–®æäº¤æ¸¬è©¦</button>
            <button id="testImage" class="test-button">3ï¸âƒ£ åœ–ç‰‡ç”Ÿæˆæ¸¬è©¦</button>
            <button id="testTouch" class="test-button">4ï¸âƒ£ è§¸æ§äº‹ä»¶æ¸¬è©¦</button>
            <button id="testMainApp" class="test-button">5ï¸âƒ£ ä¸»æ‡‰ç”¨æŒ‰éˆ•æ¸¬è©¦</button>
        </div>
        
        <div id="status" class="status info">æº–å‚™æ¸¬è©¦...</div>
        
        <div class="debug-info">
            <h5>ğŸ“‹ èª¿è©¦æ—¥èªŒ</h5>
            <div id="log" class="log"></div>
            <button id="clearLog" class="btn btn-sm btn-secondary">æ¸…é™¤æ—¥èªŒ</button>
        </div>
        
        <div class="debug-info">
            <h5>ğŸ–¼ï¸ æ¸¬è©¦çµæœ</h5>
            <div id="result"></div>
            <img id="testImageElement" style="max-width: 100%; display: none; border: 2px solid #28a745; border-radius: 8px; margin-top: 10px;">
        </div>
    </div>

    <script>
        // æ—¥èªŒç³»çµ±
        const logElement = document.getElementById('log');
        const statusElement = document.getElementById('status');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            console.log(logEntry);
            
            const div = document.createElement('div');
            div.textContent = logEntry;
            div.style.color = type === 'error' ? '#ff6b6b' : type === 'success' ? '#51cf66' : '#74c0fc';
            logElement.appendChild(div);
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function setStatus(message, type = 'info') {
            statusElement.textContent = message;
            statusElement.className = `status ${type}`;
        }
        
        // è¨­å‚™ä¿¡æ¯æª¢æ¸¬
        function detectDevice() {
            const info = {
                'User Agent': navigator.userAgent,
                'è¢å¹•å°ºå¯¸': `${window.screen.width} x ${window.screen.height}`,
                'è¦–çª—å°ºå¯¸': `${window.innerWidth} x ${window.innerHeight}`,
                'è¨­å‚™åƒç´ æ¯”': window.devicePixelRatio,
                'è§¸æ§æ”¯æ´': 'ontouchstart' in window ? 'æ˜¯' : 'å¦',
                'iOSç‰ˆæœ¬': /OS (\d+)_(\d+)/.test(navigator.userAgent) ? RegExp.$1 + '.' + RegExp.$2 : 'æœªçŸ¥',
                'ç€è¦½å™¨': navigator.userAgent.includes('Safari') ? 'Safari' : navigator.userAgent.includes('Chrome') ? 'Chrome' : 'å…¶ä»–',
                'èªè¨€': navigator.language,
                'æ™‚å€': Intl.DateTimeFormat().resolvedOptions().timeZone
            };
            
            const deviceInfoElement = document.getElementById('deviceInfo');
            deviceInfoElement.innerHTML = Object.entries(info)
                .map(([key, value]) => `<strong>${key}:</strong> ${value}`)
                .join('<br>');
            
            log('è¨­å‚™ä¿¡æ¯æª¢æ¸¬å®Œæˆ', 'success');
        }
        
        // æ¸¬è©¦å‡½æ•¸
        document.getElementById('testBasic').addEventListener('click', function() {
            log('é–‹å§‹åŸºæœ¬åŠŸèƒ½æ¸¬è©¦');
            setStatus('æ¸¬è©¦åŸºæœ¬åŠŸèƒ½...', 'warning');
            
            try {
                // æ¸¬è©¦ JavaScript åŸºæœ¬åŠŸèƒ½
                const testObj = { test: 'value' };
                const testArray = [1, 2, 3];
                const testPromise = new Promise(resolve => resolve('ok'));
                
                log('âœ… ç‰©ä»¶å‰µå»ºæ­£å¸¸');
                log('âœ… é™£åˆ—æ“ä½œæ­£å¸¸');
                log('âœ… Promise æ”¯æ´æ­£å¸¸');
                
                // æ¸¬è©¦ DOM æ“ä½œ
                const testDiv = document.createElement('div');
                testDiv.textContent = 'æ¸¬è©¦å…ƒç´ ';
                log('âœ… DOM æ“ä½œæ­£å¸¸');
                
                // æ¸¬è©¦äº‹ä»¶ç›£è½
                testDiv.addEventListener('click', () => {});
                log('âœ… äº‹ä»¶ç›£è½æ­£å¸¸');
                
                setStatus('âœ… åŸºæœ¬åŠŸèƒ½æ¸¬è©¦é€šé', 'success');
                
            } catch (error) {
                log('âŒ åŸºæœ¬åŠŸèƒ½æ¸¬è©¦å¤±æ•—: ' + error.message, 'error');
                setStatus('âŒ åŸºæœ¬åŠŸèƒ½æ¸¬è©¦å¤±æ•—', 'error');
            }
        });
        
        document.getElementById('testForm').addEventListener('click', function() {
            log('é–‹å§‹è¡¨å–®æäº¤æ¸¬è©¦');
            setStatus('æ¸¬è©¦è¡¨å–®æäº¤...', 'warning');
            
            try {
                // å‰µå»ºæ¸¬è©¦è¡¨å–®
                const form = document.createElement('form');
                const input = document.createElement('input');
                input.type = 'text';
                input.value = 'test';
                form.appendChild(input);
                
                // æ¸¬è©¦è¡¨å–®äº‹ä»¶
                let eventTriggered = false;
                form.addEventListener('submit', function(e) {
                    e.preventDefault();
                    eventTriggered = true;
                    log('âœ… è¡¨å–®æäº¤äº‹ä»¶è§¸ç™¼');
                });
                
                // æ¨¡æ“¬æäº¤
                const submitEvent = new Event('submit', { bubbles: true, cancelable: true });
                form.dispatchEvent(submitEvent);
                
                if (eventTriggered) {
                    setStatus('âœ… è¡¨å–®æäº¤æ¸¬è©¦é€šé', 'success');
                } else {
                    log('âŒ è¡¨å–®æäº¤äº‹ä»¶æœªè§¸ç™¼', 'error');
                    setStatus('âŒ è¡¨å–®æäº¤æ¸¬è©¦å¤±æ•—', 'error');
                }
                
            } catch (error) {
                log('âŒ è¡¨å–®æäº¤æ¸¬è©¦å¤±æ•—: ' + error.message, 'error');
                setStatus('âŒ è¡¨å–®æäº¤æ¸¬è©¦å¤±æ•—', 'error');
            }
        });
        
        document.getElementById('testImage').addEventListener('click', function() {
            log('é–‹å§‹åœ–ç‰‡ç”Ÿæˆæ¸¬è©¦');
            setStatus('æ¸¬è©¦åœ–ç‰‡ç”Ÿæˆ...', 'warning');
            
            const input = document.getElementById('testInput').value.trim();
            if (!input) {
                log('âŒ è«‹è¼¸å…¥æ¸¬è©¦å–®å­—', 'error');
                setStatus('âŒ è«‹è¼¸å…¥æ¸¬è©¦å–®å­—', 'error');
                return;
            }
            
            try {
                // ä½¿ç”¨èˆ‡ä¸»æ‡‰ç”¨ç›¸åŒçš„é‚è¼¯ç”Ÿæˆ URL
                const prompt = `cute cartoon ${input}`;
                const encodedPrompt = encodeURIComponent(prompt);
                const imageUrl = `https://image.pollinations.ai/prompt/${encodedPrompt}?width=1024&height=1024&model=flux&enhance=true`;
                
                log('ğŸ”— ç”Ÿæˆçš„åœ–ç‰‡ URL: ' + imageUrl);
                
                // æ¸¬è©¦åœ–ç‰‡è¼‰å…¥ - ä½¿ç”¨èˆ‡ä¸»æ‡‰ç”¨ç›¸åŒçš„é‡è©¦é‚è¼¯
                const img = document.getElementById('testImageElement');
                const resultDiv = document.getElementById('result');
                
                let retryCount = 0;
                const maxRetries = 3;
                let loadTimeout;
                
                const loadImage = (url) => {
                    log(`ğŸ”„ å˜—è©¦è¼‰å…¥åœ–ç‰‡ (ç¬¬ ${retryCount + 1} æ¬¡)`);
                    
                    img.onload = function() {
                        log('âœ… åœ–ç‰‡è¼‰å…¥æˆåŠŸ', 'success');
                        setStatus('âœ… åœ–ç‰‡ç”Ÿæˆæ¸¬è©¦é€šé', 'success');
                        if (loadTimeout) clearTimeout(loadTimeout);
                        resultDiv.innerHTML = `
                            <div class="alert alert-success">
                                <strong>âœ… æˆåŠŸï¼</strong><br>
                                å–®å­—: ${input}<br>
                                åœ–ç‰‡å·²è¼‰å…¥<br>
                                é‡è©¦æ¬¡æ•¸: ${retryCount}
                            </div>
                        `;
                    };
                    
                    img.onerror = function() {
                        log('âŒ åœ–ç‰‡è¼‰å…¥å¤±æ•—', 'error');
                        if (loadTimeout) clearTimeout(loadTimeout);
                        
                        if (retryCount < maxRetries) {
                            retryCount++;
                            log(`ğŸ”„ æº–å‚™é‡è©¦è¼‰å…¥åœ–ç‰‡ (${retryCount}/${maxRetries})`);
                            setTimeout(() => loadImage(url), 2000 * retryCount);
                        } else {
                            setStatus('âŒ åœ–ç‰‡è¼‰å…¥å¤±æ•—', 'error');
                            resultDiv.innerHTML = `
                                <div class="alert alert-danger">
                                    <strong>âŒ å¤±æ•—ï¼</strong><br>
                                    åœ–ç‰‡ç„¡æ³•è¼‰å…¥<br>
                                    å·²é‡è©¦ ${maxRetries} æ¬¡<br>
                                    å¯èƒ½æ˜¯ç¶²è·¯å•é¡Œæˆ– API é™åˆ¶
                                </div>
                            `;
                        }
                    };
                    
                    // iOS Safari éœ€è¦æ›´é•·çš„è¼‰å…¥æ™‚é–“
                    loadTimeout = setTimeout(() => {
                        log('â° åœ–ç‰‡è¼‰å…¥è¶…æ™‚');
                        if (retryCount < maxRetries) {
                            retryCount++;
                            log(`ğŸ”„ è¶…æ™‚é‡è©¦è¼‰å…¥åœ–ç‰‡ (${retryCount}/${maxRetries})`);
                            loadImage(url);
                        } else {
                            setStatus('â° åœ–ç‰‡è¼‰å…¥è¶…æ™‚', 'warning');
                            resultDiv.innerHTML = `
                                <div class="alert alert-warning">
                                    <strong>â° è¶…æ™‚ï¼</strong><br>
                                    åœ–ç‰‡è¼‰å…¥è¶…æ™‚<br>
                                    å·²é‡è©¦ ${maxRetries} æ¬¡<br>
                                    è«‹æª¢æŸ¥ç¶²è·¯é€£ç·š
                                </div>
                            `;
                        }
                    }, 15000);
                    
                    img.src = url;
                };
                
                img.style.display = 'block';
                loadImage(imageUrl);
                
            } catch (error) {
                log('âŒ åœ–ç‰‡ç”Ÿæˆæ¸¬è©¦å¤±æ•—: ' + error.message, 'error');
                setStatus('âŒ åœ–ç‰‡ç”Ÿæˆæ¸¬è©¦å¤±æ•—', 'error');
            }
        });
        
        document.getElementById('testTouch').addEventListener('click', function() {
            log('é–‹å§‹è§¸æ§äº‹ä»¶æ¸¬è©¦');
            setStatus('æ¸¬è©¦è§¸æ§äº‹ä»¶...', 'warning');
            
            try {
                // æ¸¬è©¦è§¸æ§äº‹ä»¶
                const testButton = document.createElement('button');
                testButton.textContent = 'è§¸æ§æ¸¬è©¦æŒ‰éˆ•';
                testButton.style.cssText = 'width: 100%; padding: 10px; margin: 10px 0; background: #007bff; color: white; border: none; border-radius: 5px;';
                
                let touchStarted = false;
                let touchEnded = false;
                let clicked = false;
                
                testButton.addEventListener('touchstart', () => {
                    touchStarted = true;
                    log('âœ… touchstart äº‹ä»¶è§¸ç™¼');
                });
                
                testButton.addEventListener('touchend', () => {
                    touchEnded = true;
                    log('âœ… touchend äº‹ä»¶è§¸ç™¼');
                });
                
                testButton.addEventListener('click', () => {
                    clicked = true;
                    log('âœ… click äº‹ä»¶è§¸ç™¼');
                });
                
                document.getElementById('result').appendChild(testButton);
                
                // æ¨¡æ“¬è§¸æ§äº‹ä»¶
                const touchStart = new TouchEvent('touchstart', { bubbles: true });
                const touchEnd = new TouchEvent('touchend', { bubbles: true });
                const clickEvent = new MouseEvent('click', { bubbles: true });
                
                testButton.dispatchEvent(touchStart);
                testButton.dispatchEvent(touchEnd);
                testButton.dispatchEvent(clickEvent);
                
                setTimeout(() => {
                    if (touchStarted && touchEnded && clicked) {
                        setStatus('âœ… è§¸æ§äº‹ä»¶æ¸¬è©¦é€šé', 'success');
                    } else {
                        log(`âŒ è§¸æ§äº‹ä»¶æ¸¬è©¦éƒ¨åˆ†å¤±æ•— - touchstart: ${touchStarted}, touchend: ${touchEnded}, click: ${clicked}`, 'error');
                        setStatus('âš ï¸ è§¸æ§äº‹ä»¶æ¸¬è©¦éƒ¨åˆ†å¤±æ•—', 'warning');
                    }
                }, 100);
                
            } catch (error) {
                log('âŒ è§¸æ§äº‹ä»¶æ¸¬è©¦å¤±æ•—: ' + error.message, 'error');
                setStatus('âŒ è§¸æ§äº‹ä»¶æ¸¬è©¦å¤±æ•—', 'error');
            }
        });
        
        document.getElementById('testMainApp').addEventListener('click', function() {
            log('é–‹å§‹ä¸»æ‡‰ç”¨æŒ‰éˆ•æ¸¬è©¦');
            setStatus('æ¸¬è©¦ä¸»æ‡‰ç”¨æŒ‰éˆ•åŠŸèƒ½...', 'warning');
            
            try {
                // å‰µå»ºèˆ‡ä¸»æ‡‰ç”¨ç›¸åŒçš„æŒ‰éˆ•çµæ§‹
                const testForm = document.createElement('form');
                testForm.id = 'testMainForm';
                
                const testInput = document.createElement('input');
                testInput.type = 'text';
                testInput.value = 'apple';
                testInput.className = 'test-input';
                
                const testButton = document.createElement('button');
                testButton.type = 'submit';
                testButton.className = 'test-button';
                testButton.style.cssText += '-webkit-appearance: none; -webkit-tap-highlight-color: transparent;';
                testButton.setAttribute('ontouchstart', '');
                testButton.innerHTML = 'ğŸ¨ æ¸¬è©¦ç”ŸæˆæŒ‰éˆ•';
                
                testForm.appendChild(testInput);
                testForm.appendChild(testButton);
                document.getElementById('result').appendChild(testForm);
                
                let formSubmitted = false;
                let touchStarted = false;
                let clicked = false;
                
                // è¡¨å–®æäº¤äº‹ä»¶
                testForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    formSubmitted = true;
                    log('âœ… è¡¨å–®æäº¤äº‹ä»¶è§¸ç™¼');
                });
                
                // æŒ‰éˆ•è§¸æ§äº‹ä»¶
                testButton.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    touchStarted = true;
                    log('âœ… æŒ‰éˆ• touchstart äº‹ä»¶è§¸ç™¼');
                    
                    // æ¨¡æ“¬ä¸»æ‡‰ç”¨çš„ç”Ÿæˆé‚è¼¯
                    const input = testInput.value.trim();
                    if (input) {
                        const prompt = `cute cartoon ${input}`;
                        const encodedPrompt = encodeURIComponent(prompt);
                        const imageUrl = `https://image.pollinations.ai/prompt/${encodedPrompt}?width=1024&height=1024&model=flux&enhance=true`;
                        log('ğŸ”— æ¨¡æ“¬ç”Ÿæˆ URL: ' + imageUrl);
                    }
                }, { passive: false });
                
                // æŒ‰éˆ•é»æ“Šäº‹ä»¶
                testButton.addEventListener('click', function(e) {
                    e.preventDefault();
                    clicked = true;
                    log('âœ… æŒ‰éˆ• click äº‹ä»¶è§¸ç™¼');
                });
                
                log('ğŸ“± è«‹é»æ“Šæ¸¬è©¦æŒ‰éˆ•ä¾†æ¸¬è©¦åŠŸèƒ½');
                
                // 5ç§’å¾Œæª¢æŸ¥çµæœ
                setTimeout(() => {
                    if (touchStarted || clicked || formSubmitted) {
                        setStatus('âœ… ä¸»æ‡‰ç”¨æŒ‰éˆ•æ¸¬è©¦é€šé', 'success');
                        log(`âœ… æ¸¬è©¦çµæœ - touchstart: ${touchStarted}, click: ${clicked}, form: ${formSubmitted}`, 'success');
                    } else {
                        setStatus('âš ï¸ è«‹æ‰‹å‹•é»æ“Šæ¸¬è©¦æŒ‰éˆ•', 'warning');
                        log('âš ï¸ å°šæœªæª¢æ¸¬åˆ°æŒ‰éˆ•äº’å‹•ï¼Œè«‹æ‰‹å‹•é»æ“Šæ¸¬è©¦æŒ‰éˆ•', 'warning');
                    }
                }, 5000);
                
            } catch (error) {
                log('âŒ ä¸»æ‡‰ç”¨æŒ‰éˆ•æ¸¬è©¦å¤±æ•—: ' + error.message, 'error');
                setStatus('âŒ ä¸»æ‡‰ç”¨æŒ‰éˆ•æ¸¬è©¦å¤±æ•—', 'error');
            }
        });
        
        document.getElementById('clearLog').addEventListener('click', function() {
            logElement.innerHTML = '';
            log('æ—¥èªŒå·²æ¸…é™¤');
        });
        
        // é é¢è¼‰å…¥å®Œæˆ
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸ“± iPhone èª¿è©¦é é¢è¼‰å…¥å®Œæˆ', 'success');
            detectDevice();
            setStatus('æº–å‚™å°±ç·’ï¼Œè«‹é–‹å§‹æ¸¬è©¦', 'info');
        });
        
        // éŒ¯èª¤æ•ç²
        window.addEventListener('error', function(e) {
            log('ğŸ’¥ JavaScript éŒ¯èª¤: ' + e.message + ' (è¡Œ ' + e.lineno + ')', 'error');
        });
        
        window.addEventListener('unhandledrejection', function(e) {
            log('ğŸ’¥ Promise éŒ¯èª¤: ' + e.reason, 'error');
        });
    </script>
</body>
</html>